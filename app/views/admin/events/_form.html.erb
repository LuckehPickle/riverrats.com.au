<%= form_with model: [:admin, @event.becomes(Event)] do |form| %>

    <%= render partial: 'application/form-errors', locals: { object: @event } %>

    <!-- Basic event info -->
    <section>
        <div class="section-outline">
            <h2>Basic info</h2>
        </div>
        <div class="section-content">

            <!-- Title -->
            <div class="field">
                <%= form.label :title %><br/>
                <%= form.text_field :title, autofocus: true, id: 'event_title' %>
            </div>

            <!-- Description -->
            <div class="field">
                <%= form.label :description %><br/>
                <%= form.text_area :description, id: 'event_description' %>
            </div>

            <!-- Event is held at this venue -->
            <div class="field">
                <%= form.label :venue_id %><br/>
                <%= form.collection_select :venue_id, Venue.all, :id, :name %>
            </div>

        </div>
    </section>

    <!-- Time -->
    <section>
        <div class="section-outline">
            <h2>Occurs at</h2>
        </div>
        <div class="section-content">

            <!-- Starts at -->
            <div class="field">
                <%= form.label :start_at %><br/>
                <%= form.datetime_select :start_at %>
            </div>

            <!-- Recurring or one time -->
            <div class="field">
                <%= form.label :type %>
                <%= form.select :type, options_for_select(
                    [
                        ['One time event', SingleEvent.sti_name],
                        ['Recurring event', RecurringEvent.sti_name]
                    ],
                    @event.type
                ), {}, id: 'event_type' %>
            </div>

            <!-- Fields related to a recurring event -->
            <div id="recurring-event-fields">

                <!-- Period of time between events -->
                <div class="field">
                    <%= form.label :period, 'Occurs' %>
                    <%= form.select :period, RecurringEvent.periods.keys.to_a, {}, id: 'event_period' %>
                </div>

                <!-- Number of periods between events -->
                <div class="field">
                    <%= form.label :interval, 'Every' %>
                    <%= form.number_field :interval,
                                          value: params.has_key?(:interval) ? params[:interval] : 1,
                                          min: 1, style: 'width: 60px;',
                                          id: 'event_interval' %>
                    <span id="interval-label">day(s)</span>
                </div>

                <!-- Optional days of the week to perform on -->
                <div class="field" id="weekday-fields">
                    <%= form.label 'On these days:' %><br/>
                    <%= week_day_checkboxes form, @event %>
                </div>

                <!-- Provides a summary of the recurrence schedule -->
                <p style="font-weight: bold;">Summary: <span id="summary" style="font-weight: normal;"></span></p>

            </div>

        </div>
    </section>

    <div class="field buttons">
        <%= form.submit class: 'button' %>
        <%= link_to 'Cancel', admin_events_path, class: 'button-tertiary' %>
    </div>

<% end %>

<script>

//     var $summary = $("#summary");
//     var $periodField = $("#event_period");
//     var $intervalField = $("#event_interval");
//     var $weeklyField = $("#weekday-fields");
//     var $typeSelect = $("#event_type");
//     var $recurringEventFields = $("#recurring-event-fields");

    //
    // // Wait for the DOM to be ready
    // $(document).on("turbolinks:load", function () {
    //
    //     $summary = $("#summary");
    //     $periodField = $("#event_period");
    //     $intervalField = $("#event_interval");
    //     $weeklyField = $("#weekday-fields");
    //     $typeSelect = $("#event_type");
    //     $recurringEventFields = $("#recurring-event-fields");
    //
    //     // Register events
    //     $(document).off("change");
    //     $(document).on("change", $periodField, onSelectChange);
    //     $(document).on("change", $intervalField,  updateSummary);
    //     $(document).on("change", "input[type='checkbox']",   updateSummary);
    //     $(document).on("change", $typeSelect, updateType);
    //
    //     updateSummary();
    //
    // });
    //
    // // Hide weekly fields if the currently selected period is not weekly
    // if ($periodField.val() !== "weekly") {
    //     $weeklyField.hide();
    // }
    //
    // // Hide recurring event fields if necessary
    // if ($typeSelect.val() === "Event") {
    //     $recurringEventFields.hide();
    // }

</script>